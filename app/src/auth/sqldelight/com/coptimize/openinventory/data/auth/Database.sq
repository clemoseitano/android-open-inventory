CREATE TABLE IF NOT EXISTS customers ( id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000), name TEXT, contact TEXT, payment_method TEXT, created_at TEXT DEFAULT CURRENT_TIMESTAMP, updated_at TEXT DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL);
CREATE TABLE IF NOT EXISTS out_of_stock_log ( id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000),     product_id INTEGER NOT NULL,    product_name TEXT NOT NULL,    attempted_quantity INTEGER NOT NULL,    available_quantity INTEGER NOT NULL,    resolved INTEGER NOT NULL DEFAULT 0,    created_at TEXT DEFAULT CURRENT_TIMESTAMP,     updated_at TEXT DEFAULT CURRENT_TIMESTAMP , user_id TEXT REFERENCES users(id));
CREATE TABLE IF NOT EXISTS products ( id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000), name TEXT COLLATE NOCASE NOT NULL, category TEXT COLLATE NOCASE NOT NULL, manufacturer TEXT COLLATE NOCASE, barcode TEXT UNIQUE COLLATE NOCASE, price REAL NOT NULL, tax REAL DEFAULT 0, tax_is_flat_rate INTEGER NOT NULL DEFAULT 0, quantity INTEGER NOT NULL, image_path TEXT, section TEXT, shelf TEXT, created_at TEXT DEFAULT CURRENT_TIMESTAMP, updated_at TEXT DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL, user_id TEXT REFERENCES users(id));
CREATE TABLE IF NOT EXISTS sale_items ( id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000), sale_id INTEGER NOT NULL, product_id INTEGER NOT NULL, quantity INTEGER NOT NULL, price REAL NOT NULL, created_at TEXT DEFAULT CURRENT_TIMESTAMP, updated_at TEXT DEFAULT CURRENT_TIMESTAMP, FOREIGN KEY (sale_id) REFERENCES sales(id) ON DELETE CASCADE, FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS sales ( id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000), customer_id INTEGER DEFAULT NULL, date TEXT DEFAULT CURRENT_TIMESTAMP, subtotal REAL NOT NULL, tax REAL NOT NULL, discount REAL NOT NULL, total REAL NOT NULL, paid_amount REAL NOT NULL, change_amount REAL NOT NULL DEFAULT 0.0, created_at TEXT DEFAULT CURRENT_TIMESTAMP, updated_at TEXT DEFAULT CURRENT_TIMESTAMP, user_id TEXT REFERENCES users(id), FOREIGN KEY (customer_id) REFERENCES customers(id) ON DELETE SET NULL);
CREATE TABLE IF NOT EXISTS saved_carts ( id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000), customer_id INTEGER, items TEXT, status TEXT CHECK(status IN ('active', 'pending', 'completed', 'cancelled')) DEFAULT 'pending', created_at TEXT DEFAULT CURRENT_TIMESTAMP, updated_at TEXT DEFAULT CURRENT_TIMESTAMP, user_id TEXT REFERENCES users(id), FOREIGN KEY(customer_id) REFERENCES customers(id) ON DELETE CASCADE);
CREATE TABLE IF NOT EXISTS stocks ( id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000), product_id INTEGER NOT NULL, supplier TEXT COLLATE NOCASE, supplier_contact TEXT COLLATE NOCASE, unit_price REAL NOT NULL, purchase_price REAL NOT NULL, purchase_date TEXT, expiry_date TEXT, quantity INTEGER NOT NULL, created_at TEXT DEFAULT CURRENT_TIMESTAMP, updated_at TEXT DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL, user_id TEXT REFERENCES users(id), FOREIGN KEY (product_id) REFERENCES products(id) ON DELETE SET NULL);
CREATE TABLE IF NOT EXISTS users (id TEXT PRIMARY KEY DEFAULT (ABS(RANDOM()) % 1000000000000 + 100000000000), username TEXT UNIQUE NOT NULL COLLATE NOCASE, password_hash TEXT NOT NULL, role TEXT CHECK(role IN ('superadmin', 'admin', 'staff')) NOT NULL DEFAULT 'staff', last_login TEXT, created_at TEXT DEFAULT CURRENT_TIMESTAMP, updated_at TEXT DEFAULT CURRENT_TIMESTAMP, deleted_at TEXT DEFAULT NULL);